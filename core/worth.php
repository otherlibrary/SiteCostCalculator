<?phpinclude("config.php");$domain = $_GET['domain'];if ($domain) {    //$url3 = strtolower($_GET['domain']);    $findme = 'www';    $pos = strpos($domain, $findme);    $num = strtolower($domain);    if ($pos === false) {        $num1 = "http://" . $num;        $url = parse_url($num1);    } else {        $url = parse_url($num);    }//echo $url3;//settings - host and user agent    $googlehost = 'toolbarqueries.google.com';    $googleua = 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.6) Gecko/20060728 Firefox/1.5';//convert a string to a 32-bit integer    function StrToNum($Str, $Check, $Magic)    {        $Int32Unit = 4294967296;  // 2^32        $length = strlen($Str);        for ($i = 0; $i < $length; $i++) {            $Check *= $Magic;            //If the float is beyond the boundaries of integer (usually +/- 2.15e+9 = 2^31),            //  the result of converting to integer is undefined            //  refer to http://www.php.net/manual/en/language.types.integer.php            if ($Check >= $Int32Unit) {                $Check = ($Check - $Int32Unit * (int)($Check / $Int32Unit));                //if the check less than -2^31                $Check = ($Check < -2147483648) ? ($Check + $Int32Unit) : $Check;            }            $Check += ord($Str{$i});        }        return $Check;    }//genearate a hash for a url    function HashURL($String)    {        $Check1 = StrToNum($String, 0x1505, 0x21);        $Check2 = StrToNum($String, 0, 0x1003F);        $Check1 >>= 2;        $Check1 = (($Check1 >> 4) & 0x3FFFFC0) | ($Check1 & 0x3F);        $Check1 = (($Check1 >> 4) & 0x3FFC00) | ($Check1 & 0x3FF);        $Check1 = (($Check1 >> 4) & 0x3C000) | ($Check1 & 0x3FFF);        $T1 = (((($Check1 & 0x3C0) << 4) | ($Check1 & 0x3C)) << 2) | ($Check2 & 0xF0F);        $T2 = (((($Check1 & 0xFFFFC000) << 4) | ($Check1 & 0x3C00)) << 0xA) | ($Check2 & 0xF0F0000);        return ($T1 | $T2);    }//genearate a checksum for the hash string    function CheckHash($Hashnum)    {        $CheckByte = 0;        $Flag = 0;        $HashStr = sprintf('%u', $Hashnum);        $length = strlen($HashStr);        for ($i = $length - 1; $i >= 0; $i--) {            $Re = $HashStr{$i};            if (1 === ($Flag % 2)) {                $Re += $Re;                $Re = (int)($Re / 10) + ($Re % 10);            }            $CheckByte += $Re;            $Flag++;        }        $CheckByte %= 10;        if (0 !== $CheckByte) {            $CheckByte = 10 - $CheckByte;            if (1 === ($Flag % 2)) {                if (1 === ($CheckByte % 2)) {                    $CheckByte += 9;                }                $CheckByte >>= 1;            }        }        return '7' . $CheckByte . $HashStr;    }//return the pagerank checksum hash    function getch($url)    {        return CheckHash(HashURL($url));    }//return the pagerank figure    function getpr($url)    {        global $googlehost, $googleua;        $ch = getch($url);        $fp = fsockopen($googlehost, 80, $errno, $errstr, 30);        if ($fp) {            $out = "GET /search?client=navclient-auto&ch=$ch&features=Rank&q=info:$url HTTP/1.1\r\n";            //echo "<pre>$out</pre>\n"; //debug only            $out .= "User-Agent: $googleua\r\n";            $out .= "Host: $googlehost\r\n";            $out .= "Connection: Close\r\n\r\n";            fwrite($fp, $out);            //$pagerank = substr(fgets($fp, 128), 4); //debug only            //echo $pagerank; //debug only            while (!feof($fp)) {                $data = fgets($fp, 128);                //echo $data;                $pos = strpos($data, "Rank_");                if ($pos === false) {                } else {                    $pr = substr($data, $pos + 9);                    $pr = trim($pr);                    $pr = str_replace("\n", '', $pr);                    return $pr;                }            }            //else { echo "$errstr ($errno)<br />\n"; } //debug only            fclose($fp);        }    }//if ((!isset($_POST['url'])) && (!isset($_GET['url']))) { echo '<form action="" method="post"><input name="url" type="text"><input type="submit" name="Submit" value="Get Pagerank"></form>'; }    ?><?    $pr = getpr($domain);    $result = mysql_query("SELECT * FROM worth WHERE domain = '$domain'");    while ($row = mysql_fetch_array($result)) {        $ipr = $row["domain"];//echo "$id $ipr $alexa2 $backlink3 $ip2 $pagerank1 $networth $dailypageview $dailyadsearn $country1"; // debug only//$echolater .= "Load Time: $totaltime seconds.</table><br>";        $goog_bak = number_format($row["google_back"]);        $yaho_bak = number_format($row["yahoo_back"]);        $altavi_bak = number_format($row["altavista_back"]);        $alldweb_bak = number_format($row["alltheweb_back"]);        if ($goog_bak == "") {            $goog_bak = "0";        }        if ($yaho_bak == "") {            $yaho_bak = "0";        }        if ($altavi_bak == "") {            $altavi_bak = "0";        }        if ($alldweb_bak == "") {            $alldweb_bak = "0";        }        $alexarank = number_format($row["alexa"]);        $pagerank = $row["pagerank"];        $ipaddress = $row["ip"];        $webworth1 = $row["worth"] * $c_value;        if ($c_symbol_placement == 1) {            $webworth = number_format($webworth1) . $c_symbol;        } else {            $webworth = $c_symbol . number_format($webworth1);        }        $country = $row["country"];    }    header("Content-type: image/png");    $im = imagecreatefrompng("images/2.png");    $font_a = 3;    $font_d = 3;    $xpos_d = 3;    $ypos_d = 4;    $string_d = "$ipr costs $webworth";    $font_e = 3;    $xpos_e = 16;    $ypos_e = 43;    $string_e = "$country";    $font_f = 3;    $xpos_f = 16;    $ypos_f = 83;    $string_f = "$ipaddress";    $font_g = 5;    $xpos_g = 205;    $ypos_g = 82;    $string_g = "$pr";    $font_h = 3;    $xpos_h = 195;    $ypos_h = 43;    $string_h = "$alexarank";    $font_i = 2;    $xpos_i = 5;    $ypos_i = 150;    $string_i = "Powered by: $siteurl";    $white = imagecolorallocate($im, 0, 0, 0);    $black = imagecolorallocate($im, 255, 255, 255);    imagestring($im, $font_d, $xpos_d, $ypos_d, $string_d, $black);    imagestring($im, $font_e, $xpos_e, $ypos_e, $string_e, $white);    imagestring($im, $font_f, $xpos_f, $ypos_f, $string_f, $white);    imagestring($im, $font_g, $xpos_g, $ypos_g, $string_g, $white);    imagestring($im, $font_h, $xpos_h, $ypos_h, $string_h, $white);    imagestring($im, $font_i, $xpos_i, $ypos_i, $string_i, $white);    imagepng($im);}?>